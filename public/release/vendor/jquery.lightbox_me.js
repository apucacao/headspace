(function(a){a.fn.lightbox_me=function(b){return this.each(function(){function c(){var b=i[0].style;g.destroyOnClose?i.add(h).remove():i.add(h).hide(),g.parentLightbox&&g.parentLightbox.fadeIn(200),j.remove(),i.undelegate(g.closeSelector,"click"),a(window).unbind("reposition",e),a(window).unbind("reposition",f),a(window).unbind("scroll",f),a(document).unbind("keyup",d),k&&b.removeExpression("top"),g.onClose()}function d(a){(a.keyCode==27||a.DOM_VK_ESCAPE==27&&a.which==0)&&g.closeEsc&&c()}function e(){a(window).height()<a(document).height()?(h.css({height:a(document).height()+"px"}),j.css({height:a(document).height()+"px"})):(h.css({height:"100%"}),k&&(a("html,body").css("height","100%"),j.css("height","100%")))}function f(){var b=i[0].style;i.css({left:"50%",marginLeft:i.outerWidth()/2*-1,zIndex:g.zIndex+3});if(i.height()+80>=a(window).height()&&(i.css("position")!="absolute"||k)){var c=a(document).scrollTop()+40;i.css({position:"absolute",top:c+"px",marginTop:0}),k&&b.removeExpression("top")}else if(i.height()+80<a(window).height())if(k){b.position="absolute";if(g.centered)b.setExpression("top",'(document.documentElement.clientHeight || document.body.clientHeight) / 2 - (this.offsetHeight / 2) + (blah = document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + "px"'),b.marginTop=0;else{var d=g.modalCSS&&g.modalCSS.top?parseInt(g.modalCSS.top):0;b.setExpression("top","((blah = document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + "+d+') + "px"')}}else g.centered?i.css({position:"fixed",top:"50%",marginTop:i.outerHeight()/2*-1}):i.css({position:"fixed"}).css(g.modalCSS)}var g=a.extend({},a.fn.lightbox_me.defaults,b),h=a(),i=a(this),j=a('<iframe id="foo" style="z-index: '+(g.zIndex+1)+';border: none; margin: 0; padding: 0; position: absolute; width: 100%; height: 100%; top: 0; left: 0; filter: mask();"/>'),k=a.browser.msie&&a.browser.version<7;if(g.showOverlay){var l=a(".js_lb_overlay:visible");l.length>0?h=a('<div class="lb_overlay_clear js_lb_overlay"/>'):h=a('<div class="'+g.classPrefix+'_overlay js_lb_overlay"/>')}if(k){var m=/^https/i.test(window.location.href||"")?"javascript:false":"about:blank";j.attr("src",m),a("body").append(j)}a("body").append(i.hide()).append(h),g.showOverlay&&(e(),h.css({position:"absolute",width:"100%",top:0,left:0,right:0,bottom:0,zIndex:g.zIndex+2,display:"none"}),h.hasClass("lb_overlay_clear")||h.css(g.overlayCSS)),g.showOverlay?h.fadeIn(g.overlaySpeed,function(){f(),i[g.appearEffect](g.lightboxSpeed,function(){e(),f(),g.onLoad()})}):(f(),i[g.appearEffect](g.lightboxSpeed,function(){g.onLoad()})),g.parentLightbox&&g.parentLightbox.fadeOut(200),a(window).resize(e).resize(f).scroll(f).keyup(d),g.closeClick&&h.click(function(a){c(),a.preventDefault}),i.delegate(g.closeSelector,"click",function(a){c(),a.preventDefault()}),i.bind("close",c),i.bind("reposition",f)})},a.fn.lightbox_me.defaults={appearEffect:"fadeIn",appearEase:"",overlaySpeed:250,lightboxSpeed:300,closeSelector:".close",closeClick:!0,closeEsc:!0,destroyOnClose:!1,showOverlay:!0,parentLightbox:!1,onLoad:function(){},onClose:function(){},classPrefix:"lb",zIndex:999,centered:!1,modalCSS:{top:"40px"},overlayCSS:{background:"black",opacity:.3}}})(jQuery)